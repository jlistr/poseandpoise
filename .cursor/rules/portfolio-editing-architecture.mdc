# Portfolio Preview & Editing Architecture â€” STRICT ENFORCEMENT

**Core Principle: If you're previewing it, you should always have the option to edit it.**

This rule defines the architecture for portfolio viewing, previewing, and editing across the Pose & Poise platform. The goal is to provide a seamless, consistent editing experience wherever a portfolio owner views their own content.

---

## Two Viewing Contexts

### 1. Public Portfolio (`/[username]`)
- **Purpose:** Public-facing portfolio for visitors, clients, and agencies
- **Audience:** Anyone on the internet
- **Editing:** NO direct editing capabilities
- **Data:** Only visible photos, published content
- **Owner Preview:** When logged-in owner views their unpublished portfolio, show a preview banner with "Go to Dashboard" link

### 2. Preview Mode (`/preview/[username]` or `/dashboard/preview/[username]`)
- **Purpose:** Owner's preview and editing environment
- **Audience:** Authenticated portfolio owner only
- **Editing:** ALWAYS available via Edit Mode toggle
- **Data:** ALL photos (including hidden), all content
- **Features:** Template switching, inline editing, photo management, publish controls

---

## The Golden Rule: Owner Previewing = Edit Access

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IF user is authenticated AND user owns the portfolio          â”‚
â”‚  AND user is viewing any preview of their portfolio             â”‚
â”‚  THEN edit capabilities MUST be available                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Requirements

1. **Never show a preview without edit access to the owner**
   - If an owner can see a preview, they can edit it
   - No "view-only" preview mode for owners

2. **Edit Mode is a toggle, not a separate route**
   - Preview and Edit are the same page with a toggle
   - URL: `/preview/[username]` or `/preview/[username]?edit=true`
   - State managed by `PortfolioPreview` component

3. **Consistent toolbar across all preview contexts**
   - Dashboard link (back arrow)
   - Template selector/indicator
   - Edit Mode toggle button
   - Save status indicator
   - Publish/Launch controls

---

## Route Architecture

### REQUIRED Routes

| Route | Purpose | Auth Required | Edit Available |
|-------|---------|---------------|----------------|
| `/[username]` | Public portfolio | No | No (redirect owner to preview) |
| `/preview/[username]` | Owner preview + edit | Yes (owner only) | Yes, always |
| `/dashboard/preview/[username]` | Legacy, redirect to `/preview/[username]` | Yes | Yes |

### FORBIDDEN Patterns

- âŒ Multiple preview routes with different capabilities
- âŒ Preview routes that don't offer editing
- âŒ Edit-only routes separate from preview
- âŒ Subscription-gated preview access (editing features may vary, but preview + basic edit must work)

---

## Component Architecture

### `PortfolioPreview` Component â€” The Single Source of Truth

All preview/edit functionality flows through this component:

```typescript
interface PortfolioPreviewProps {
  data: PortfolioData;
  username: string;
  canEdit?: boolean;           // Defaults to true for authenticated owners
  initialEditMode?: boolean;   // Start in edit mode (from ?edit=true)
}
```

### Edit Mode Context

The `EditModeContext` provides editing state and handlers to all template pages:

```typescript
interface EditModeContextValue {
  isEditMode: boolean;
  canEdit: boolean;
  // Photo editing
  photos: PortfolioPhoto[];
  onPhotosChange: (photos: PortfolioPhoto[]) => void;
  onTogglePhotoVisibility: (photoId: string) => void;
  onReorderPhotos: (fromIndex: number, toIndex: number) => void;
  onAddPhotos: (files: FileList) => Promise<void>;
  onDeletePhoto: (photoId: string) => Promise<void>;
  isUploadingPhotos: boolean;
  // Profile editing
  bio: string;
  onBioChange: (value: string) => void;
  avatarUrl: string;
  onAvatarUpload: (file: File) => Promise<void>;
  // Services editing
  services: ServiceItem[];
  onServicesChange: (services: ServiceItem[]) => void;
  onAddService: () => void;
  onUpdateService: (index: number, field: keyof ServiceItem, value: string) => void;
  onRemoveService: (index: number) => void;
  // Save status
  isSaving: boolean;
  hasChanges: boolean;
  // Template theming
  accentColor: string;
}
```

### Template Integration

Templates consume `useEditMode()` hook to enable inline editing:

```typescript
export function TemplateComponent({ data }: TemplateProps) {
  const editMode = useEditMode();
  
  // Use edit mode state if available, fall back to props
  const photos = editMode?.photos ?? data.photos;
  const bio = editMode?.bio ?? data.profile.bio;
  
  // Conditionally render edit controls
  if (editMode?.isEditMode) {
    // Show drag handles, visibility toggles, inline editors
  }
}
```

---

## Editing Capabilities by Tier

While preview access is universal, editing features may vary by subscription:

| Feature | FREE | PROFESSIONAL | DELUXE |
|---------|------|--------------|--------|
| View own preview | âœ… | âœ… | âœ… |
| Toggle Edit Mode | âœ… | âœ… | âœ… |
| Reorder photos | âœ… | âœ… | âœ… |
| Toggle photo visibility | âœ… | âœ… | âœ… |
| Edit bio/profile | âœ… | âœ… | âœ… |
| Upload new photos | âœ… | âœ… | âœ… |
| Delete photos | âœ… | âœ… | âœ… |
| Edit services | âœ… | âœ… | âœ… |
| Premium templates | âŒ | âœ… | âœ… |
| AI-assisted editing | âŒ | âŒ | âœ… |

**IMPORTANT:** Never gate basic editing behind a paywall. The core editing experience must work for all users.

---

## Navigation Flows

### From Dashboard to Preview/Edit

```
Dashboard â†’ "Preview Portfolio" button â†’ /preview/[username]
Dashboard â†’ "Edit Portfolio" button â†’ /preview/[username]?edit=true
```

### From Public Portfolio (Owner)

```
/[username] (owner logged in, unpublished) â†’ Shows preview banner â†’ "Go to Dashboard" link
/[username] (owner logged in, published) â†’ Could show "Edit" FAB â†’ /preview/[username]?edit=true
```

### From Preview Back to Dashboard

```
/preview/[username] â†’ Back arrow â†’ /dashboard
/preview/[username] â†’ Save & Exit â†’ Stays on preview (edit mode off)
```

---

## UI/UX Requirements

### Preview Toolbar (Always Visible)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Dashboard â”‚ ğŸ‘ Preview Mode â”‚ [Template: Elysian â–¾] â”‚ [Edit Mode] â”‚ [Launch Site] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edit Mode Banner (When Active)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸ Edit Mode Active â€” Click on text, images, or elements to edit directly.  â”‚
â”‚                       Click "Save & Exit" when done.                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edit Controls on Elements

When in edit mode, editable elements show:
- Hover state with accent color border
- Click to activate inline editor
- Photos show drag handles + visibility toggle
- Services show add/remove/reorder controls

---

## Data Flow

### Reading Data

```
Server Component (page.tsx)
    â†“ Fetches portfolio data
    â†“ Verifies ownership
    â†“ Passes to PortfolioPreview
Client Component (PortfolioPreview.tsx)
    â†“ Initializes edit state from props
    â†“ Provides EditModeContext
Template Components
    â†“ Consume useEditMode() hook
    â†“ Render with edit capabilities
```

### Saving Data

```
User makes edit (e.g., reorders photo)
    â†“ Local state updates immediately (optimistic)
    â†“ hasChanges becomes true
User clicks "Save & Exit"
    â†“ handleSave() called
    â†“ Server actions execute (savePhotoUpdates, saveTemplate, etc.)
    â†“ router.refresh() revalidates data
    â†“ Edit mode disabled
```

---

## Server Actions for Portfolio Editing

All editing operations use server actions in `/app/actions/portfolio.ts`:

| Action | Purpose |
|--------|---------|
| `savePhotoUpdates` | Update sort order and visibility |
| `saveTemplate` | Change selected template |
| `saveProfileUpdate` | Update bio, avatar, etc. |
| `saveServices` | Update service offerings |
| `uploadAvatar` | Upload new profile photo |
| `uploadPortfolioPhoto` | Add new portfolio photo |
| `deletePortfolioPhoto` | Remove photo from portfolio |
| `togglePublished` | Publish/unpublish portfolio |

---

## Migration Path (Consolidating Routes)

### Current State (Inconsistent)
- `/preview/[username]` â€” Preview + Edit
- `/dashboard/preview/[username]` â€” Preview + Edit (duplicate)
- `/[username]` â€” Public only (owner sees preview banner)

### Target State (Consolidated)
- `/preview/[username]` â€” **THE** preview + edit route
- `/dashboard/preview/[username]` â€” Redirect to `/preview/[username]`
- `/[username]` â€” Public view; owner sees "Edit" FAB linking to preview

### Implementation Steps

1. **Consolidate to single preview route** (`/preview/[username]`)
2. **Add redirect from legacy route** (`/dashboard/preview/[username]`)
3. **Add "Edit" FAB on public page for logged-in owners**
4. **Remove duplicate data fetching logic**
5. **Ensure all dashboard links point to canonical preview route**

---

## ENFORCEMENT Checklist

Before implementing any preview/editing feature:

- [ ] Owner can always access edit mode when previewing their portfolio
- [ ] Edit Mode is a toggle, not a separate route
- [ ] `PortfolioPreview` component is the single entry point for preview + edit
- [ ] Templates consume `useEditMode()` hook for edit capabilities
- [ ] Basic editing works for all subscription tiers
- [ ] Changes save via server actions, not client-side API calls
- [ ] Preview toolbar is consistent across all contexts
- [ ] Navigation flows are intuitive (Dashboard â†” Preview â†” Public)

---

## FORBIDDEN Patterns

- âŒ Creating a preview route without edit capabilities
- âŒ Gating basic edit access behind subscription tier
- âŒ Separate "view" and "edit" modes on different routes
- âŒ Templates that don't support `useEditMode()` hook
- âŒ Multiple implementations of the same editing logic
- âŒ Editing via direct API calls instead of server actions
- âŒ Preview pages that don't verify ownership before rendering
